<style>
    #bookmark-controls {
        display: inline;
        float: right;
    }
    </style>
<div class="card mt-4">
    <div class="card-body">
        <h1 class="card-title mb-3">Lease Details</h1>
        <table class="table table-bordered">
            <caption class="visually-hidden">Full details of the selected lease</caption>
            <tbody>
                <% Object.entries(lease).forEach(([key, value]) => { %>
                    <% if (key !== '_id' && key !== '__v' && key !== 'createdAt' && key !== 'updatedAt' && key !== 'isBookmarked' && key !== 'remainingTerm' && key !== 'expiryDate') { %>
                        <tr>
                            <th scope="row"><%= key %></th>
                            <td><%= value %></td>
                        </tr>
                    <% } %>
                <% }); %>
                <% if (lease.remainingTerm) { %>
                    <tr>
                        <th scope="row">Remaining Term</th>
                        <td><%= lease.remainingTerm %></td>
                    </tr>
                <% } %>
                <% if (lease.expiryDate) { %>
                    <tr>
                        <th scope="row">Expiry Date</th>
                        <td><%= new Date(lease.expiryDate).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' }) %></td>
                    </tr>
                <% } %>
            </tbody>
        </table>
        <div class="d-flex justify-content-between align-items-center mt-3">
            <a href="/app" class="btn btn-secondary">Back to Search</a>
            <div id="bookmark-controls" aria-label="Bookmark controls">
                <% if (!lease.isBookmarked) { %>
                    <button id="bookmark-btn" class="btn btn-primary" aria-pressed="false">
                        <span class="visually-hidden">Bookmark this lease</span>
                        <i class="bi bi-bookmark-plus" aria-hidden="true"></i> Bookmark
                    </button>
                <% } else { %>
                    <button id="unbookmark-btn" class="btn btn-danger" aria-pressed="true">
                        <span class="visually-hidden">Remove bookmark for this lease</span>
                        <i class="bi bi-bookmark-dash" aria-hidden="true"></i> Remove bookmark
                    </button>
                <% } %>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const leaseId = '<%= lease._id %>';
    const controls = document.getElementById('bookmark-controls');
    const remainingViews = document.querySelector('strong[remaining-views]');
    function updateButton(isBookmarked) {
        if (isBookmarked) {
            controls.innerHTML = '<button id="unbookmark-btn" class="btn btn-danger" aria-pressed="true">\
                <span class="visually-hidden">Remove bookmark for this lease</span>\
                <i class="bi bi-bookmark-dash" aria-hidden="true"></i> Remove bookmark</button>';
        } else {
            controls.innerHTML = '<button id="bookmark-btn" class="btn btn-primary" aria-pressed="false">\
                <span class="visually-hidden">Bookmark this lease</span>\
                <i class="bi bi-bookmark-plus" aria-hidden="true"></i> Bookmark</button>';
        }
    }
    controls.addEventListener('click', function(e) {
        if (e.target.id === 'bookmark-btn') {
            fetch(`/app/lease/${leaseId}/bookmark`, { method: 'POST' })
                .then(res => {
                    if (res.ok) updateButton(true);
                });
        } else if (e.target.id === 'unbookmark-btn') {
            fetch(`/app/lease/${leaseId}/unbookmark`, { method: 'POST' })
                .then(res => {
                    if (res.ok) updateButton(false);
                });
        }
    });
});
</script> 